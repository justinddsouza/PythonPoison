--CREATE MEDICARE DIAGNOSIS INPUT TABLE FOR DXCG 

-- CREATE TABLE WITH STATIC COLUMNS FOR FIXED WIDTH FILE
CREATE TABLE $SDM_GROUPER_DXCG_MEDICARE_DIAGNOSIS_INPUT_$ROMO_$YYYYMM
(
	MEMBER_ID CHARACTER (26),
	DX_01 CHARACTER (10),
	DX_02 CHARACTER (10),
	DX_03 CHARACTER (10),
	DX_04 CHARACTER (10),
	DX_05 CHARACTER (10),
	DX_06 CHARACTER (10),
	DX_07 CHARACTER (10),
	DX_08 CHARACTER (10),
	DX_09 CHARACTER (10),
	DX_10 CHARACTER (10),
	DX_11 CHARACTER (10),
	DX_12 CHARACTER (10),
	DX_13 CHARACTER (10),
	DX_14 CHARACTER (10),
	DX_15 CHARACTER (10),
	DX_16 CHARACTER (10),
	DX_17 CHARACTER (10),
	DX_18 CHARACTER (10),
	DX_19 CHARACTER (10),
	DX_20 CHARACTER (10),
	DX_21 CHARACTER (10),
	DX_22 CHARACTER (10),
	DX_23 CHARACTER (10),
	DX_24 CHARACTER (10),
	DX_25 CHARACTER (10),
	DX_26 CHARACTER (10),
	DX_27 CHARACTER (10),
	DX_28 CHARACTER (10),
	DX_29 CHARACTER (10),
	DX_30 CHARACTER (10),
	DX_31 CHARACTER (10),
	DX_32 CHARACTER (10),
	DX_33 CHARACTER (10),
	DX_34 CHARACTER (10),
	DX_35 CHARACTER (10),
	DX_36 CHARACTER (10),
	DX_37 CHARACTER (10),
	DX_38 CHARACTER (10),
	DX_39 CHARACTER (10),
	DX_40 CHARACTER (10),
	DX_41 CHARACTER (10),
	DIAG_SOURCE CHARACTER (1),
	ICD_VERSION CHARACTER (2)
)
DISTRIBUTE ON (MEMBER_ID, DX_01, DX_02, DX_03);

---------------INSERT DATA
INSERT INTO $SDM_GROUPER_DXCG_MEDICARE_DIAGNOSIS_INPUT_$ROMO_$YYYYMM
(MEMBER_ID,
DX_01,DX_02,DX_03,DX_04,DX_05,DX_06,DX_07,DX_08,DX_09,DX_10,
DX_11,DX_12,DX_13,DX_14,DX_15,DX_16,DX_17,DX_18,DX_19,DX_20,
DX_21,DX_22,DX_23,DX_24,DX_25,DX_26,DX_27,DX_28,DX_29,DX_30,
DX_31,DX_32,DX_33,DX_34,DX_35,DX_36,DX_37,DX_38,DX_39,DX_40,
DX_41,
DIAG_SOURCE,
ICD_VERSION
)
SELECT 
DISTINCT
UNIQ_PERSON_ID, 
CASE WHEN DX_01 = 'XXX' THEN '   ' ELSE DX_01 END,
CASE WHEN DX_02 = 'XXX' THEN '   ' ELSE DX_02 END,
CASE WHEN DX_03 = 'XXX' THEN '   ' ELSE DX_03 END,
CASE WHEN DX_04 = 'XXX' THEN '   ' ELSE DX_04 END,
CASE WHEN DX_05 = 'XXX' THEN '   ' ELSE DX_05 END,
CASE WHEN DX_06 = 'XXX' THEN '   ' ELSE DX_06 END,
CASE WHEN DX_07 = 'XXX' THEN '   ' ELSE DX_07 END,
CASE WHEN DX_08 = 'XXX' THEN '   ' ELSE DX_08 END,
CASE WHEN DX_09 = 'XXX' THEN '   ' ELSE DX_09 END,
CASE WHEN DX_10 = 'XXX' THEN '   ' ELSE DX_10 END,
CASE WHEN DX_11 = 'XXX' THEN '   ' ELSE DX_11 END,
CASE WHEN DX_12 = 'XXX' THEN '   ' ELSE DX_12 END,
CASE WHEN DX_13 = 'XXX' THEN '   ' ELSE DX_13 END,
CASE WHEN DX_14 = 'XXX' THEN '   ' ELSE DX_14 END,
CASE WHEN DX_15 = 'XXX' THEN '   ' ELSE DX_15 END,
CASE WHEN DX_16 = 'XXX' THEN '   ' ELSE DX_16 END,
CASE WHEN DX_17 = 'XXX' THEN '   ' ELSE DX_17 END,
CASE WHEN DX_18 = 'XXX' THEN '   ' ELSE DX_18 END,
CASE WHEN DX_19 = 'XXX' THEN '   ' ELSE DX_19 END,
CASE WHEN DX_20 = 'XXX' THEN '   ' ELSE DX_20 END,
CASE WHEN DX_21 = 'XXX' THEN '   ' ELSE DX_21 END,
CASE WHEN DX_22 = 'XXX' THEN '   ' ELSE DX_22 END,
CASE WHEN DX_23 = 'XXX' THEN '   ' ELSE DX_23 END,
CASE WHEN DX_24 = 'XXX' THEN '   ' ELSE DX_24 END,
CASE WHEN DX_25 = 'XXX' THEN '   ' ELSE DX_25 END,
CASE WHEN DX_26 = 'XXX' THEN '   ' ELSE DX_26 END,
CASE WHEN DX_27 = 'XXX' THEN '   ' ELSE DX_27 END,
CASE WHEN DX_28 = 'XXX' THEN '   ' ELSE DX_28 END,
CASE WHEN DX_29 = 'XXX' THEN '   ' ELSE DX_29 END,
CASE WHEN DX_30 = 'XXX' THEN '   ' ELSE DX_30 END,
CASE WHEN DX_31 = 'XXX' THEN '   ' ELSE DX_31 END,
CASE WHEN DX_32 = 'XXX' THEN '   ' ELSE DX_32 END,
CASE WHEN DX_33 = 'XXX' THEN '   ' ELSE DX_33 END,
CASE WHEN DX_34 = 'XXX' THEN '   ' ELSE DX_34 END,
CASE WHEN DX_35 = 'XXX' THEN '   ' ELSE DX_35 END,
CASE WHEN DX_36 = 'XXX' THEN '   ' ELSE DX_36 END,
CASE WHEN DX_37 = 'XXX' THEN '   ' ELSE DX_37 END,
CASE WHEN DX_38 = 'XXX' THEN '   ' ELSE DX_38 END,
CASE WHEN DX_39 = 'XXX' THEN '   ' ELSE DX_39 END,
CASE WHEN DX_40 = 'XXX' THEN '   ' ELSE DX_40 END,
CASE WHEN DX_41 = 'XXX' THEN '   ' ELSE DX_41 END,
CASE WHEN SUBSTR(TOB_CD,2,2) in ('11','12') THEN '2'
     WHEN (SUBSTR(TOB_CD,2,2) in ('13','83') OR PTS.DX_SOURCE ='4') THEN '4'
     WHEN (SUBSTR(TOB_CD,2,1) in ('2','3','4','6','7','8') AND SUBSTR(TOB_CD,2,2) NOT IN ('83')) THEN '6'
ELSE '8' END,
--CASE WHEN PTS.DX_SOURCE IS NULL THEN ' ' ELSE PTS.DX_SOURCE END,
CASE WHEN DOS < '2015-10-01' THEN '9' ELSE '10' END
FROM ADH_SBX_ROSETTA..MEDICARE_CLM_$YYYYM1$DD AS CLM
LEFT JOIN ADH_SBX_ROSETTA..XWALK_PROV_TYPE_SOURCE AS PTS
ON CLM.PROV_REND_TYPE_CD = PTS.PROV_TYPE OR CLM.PROV_ATT_TYPE_CD = PTS.PROV_TYPE
WHERE CLM.DENIED = 'N' 
AND CLM.DOS BETWEEN $START_DATE AND $END_DATE
AND CHECK_DT <= $RUN_OUT_DATE
--LIMIT 10000
;